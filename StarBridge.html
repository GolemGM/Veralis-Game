<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Veralis ‚Äì StarBridge</title>
  <link rel="icon" type="image/png" href="images/veralisfavicon.png">
  <link rel="stylesheet" href="css/style.css" />
  <script defer src="js/auth.js"></script>
  <script defer src="js/logout.js"></script>
  <script defer src="js/lang.js"></script>
  <script defer src="js/events.js"></script>
  <script defer src="js/devlogs.js"></script>

  <script>
  function getLang() {
    return new URLSearchParams(location.search).get('lang')
      || document.documentElement.lang
      || 'cs';
  }
  // srovnej <html lang> podle URL
  document.documentElement.lang = getLang();
</script>

  <!-- Script ovladani jazyka -->
  
  <script>
  const currentLang = getLang();
  const token = localStorage.getItem('token');
  if (!token) {
    const loginTarget = currentLang === 'cs'
      ? 'https://golemgm.github.io/Veralis-Promo/login.html'
      : 'https://golemgm.github.io/Veralis-Promo/en/login.html';
    location.href = loginTarget;
  }
  // Pokud chce≈°, m≈Ø≈æe≈° tu z≈Østat i u loadLanguage(currentLang);
  if (typeof loadLanguage === 'function') loadLanguage(currentLang);
</script>

  
</head>
<body>
  <div class="page-wrapper">
    <header class="site-header">
      <div class="header-inner">
        <div class="logo">
          <img src="images/veralis_logo_transparent512.png" alt="VERALIS">
        </div>
        <div class="header-center">
          <button class="gold-button enter-btn" data-i18n="enterGame">üöÄ Enter the Game</button>
        </div>
        <div class="header-buttons">
          <button class="exit-btn">
            <span style="font-size: 22px; color: black;">‚¨Ö</span> Exit
          </button>
        </div>
      </div>  
    </header>

    <main class="content-wrapper">
      <section class="panel devlogs">
        <h2 data-i18n="devlogHeader">üõ†Ô∏è Patch Notes & Dev Logs</h2>
        <div class="devlog-section">
          <h2 data-i18n="devlogsubHeader">üõ†Ô∏è Devlogy</h2>
          <div id="devlog-list"><div class="event-row">Naƒç√≠t√°m...</div></div>
        </div>
      </section>

      <section class="panel events">
        <h2 data-i18n="eventHeader">üì° Star News Reporter</h2>
        <div class="event-section">
          <h2 data-i18n="eventsubHeader">üì° Hl√°≈°en√≠</h2>
          <div id="event-list"><div class="event-row">Naƒç√≠t√°m...</div></div>
        </div>
      </section>
    </main>

    <footer class="site-footer" data-i18n="footer">&copy; Veralis Project 2025</footer>
  </div>
  
  <!-- Script ovladani Enter Exit -->
  
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const enterBtn = document.querySelector('.enter-btn');
    const exitBtn  = document.querySelector('.exit-btn');

    // Enter ‚Üí v≈ædy vol√°me enterGame() (viz dal≈°√≠ script n√≠≈æe)
    if (enterBtn) {
      enterBtn.addEventListener('click', (e) => {
        e.preventDefault();
        enterGame();
      });
    }

    // Exit ‚Äì jen vyƒçistit token a j√≠t na spr√°vn√Ω login podle jazyka
    if (exitBtn) {
      exitBtn.addEventListener('click', () => {
        localStorage.removeItem('token');
        const lang = getLang();
        const loginTarget = lang === 'cs'
          ? 'https://golemgm.github.io/Veralis-Promo/login.html'
          : 'https://golemgm.github.io/Veralis-Promo/en/login.html';
        location.href = loginTarget;
      });
    }

    // (voliteln√©) pokud tv≈Øj js/lang.js exportuje loadLanguage
    if (typeof loadLanguage === 'function') loadLanguage(getLang());
  });
</script>
<script>
  async function enterGame() {
    const lang = getLang();

    try {
      const r = await fetch('/api/character/status', { credentials: 'include' });
      const s = await r.json();

      if (s && typeof s.cc_stage === 'number' && s.cc_stage >= 2) {
        // hotovo ‚Üí rovnou do hry
        location.href = `game.html?lang=${lang}`;
      } else {
        // pot≈ôebuje proj√≠t CC (zmƒõ≈à c√≠lovou cestu, pokud m√°≈° serverovou route)
        location.href = `charactercreation.html?lang=${lang}`;
        // p≈ô√≠padnƒõ: location.href = `/character-creation?lang=${lang}`;
      }
    } catch (e) {
      // na chybu radƒõji do CC
      location.href = `charactercreation.html?lang=${lang}`;
    }
  }
</script>
</body>
</html>
